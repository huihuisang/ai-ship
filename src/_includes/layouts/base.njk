<!DOCTYPE html>
{% set languageList = supportedLangs or [] %}
{% set derivedLang = false %}
{% if page.url and languageList %}
  {% for langCandidate in languageList %}
    {% if langCandidate != (site.defaultLang or 'zh') and page.url.startsWith('/' ~ langCandidate ~ '/') %}
      {% set derivedLang = langCandidate %}
    {% endif %}
  {% endfor %}
{% endif %}
{% set currentLang = page.lang or lang or derivedLang or site.defaultLang or 'zh' %}
{% set fallbackLang = site.defaultLang or 'zh' %}
{% set siteLangData = site.languages[currentLang] or site.languages[fallbackLang] or site.languages.zh %}
{% set feedPathPrefix = '' %}
{% if currentLang != (site.defaultLang or 'zh') %}
  {% set feedPathPrefix = '/' ~ currentLang %}
{% endif %}
{% set pageTitle = title or siteLangData.title %}
{% set pageDescription = description or siteLangData.description %}
<html lang="{{ currentLang }}" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if title %}{{ title }} · {{ siteLangData.title }}{% else %}{{ siteLangData.title }}{% endif %}</title>
  <meta name="description" content="{{ pageDescription }}">
  {% include 'partials/meta.njk' %}
  <link rel="preload" href="/assets/main.css" as="style">
  <link rel="stylesheet" href="/assets/main.css">
  <script>document.documentElement.dataset.theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');</script>
</head>
<body>
    {% include 'sprite.svg' %}
    <div class="site-header__top">
      <div class="site-controls">
        <div class="control-group">
        <button type="button" class="control-btn" data-control="theme" aria-label="{{ 'controls.theme.switch' | t(currentLang) }}">
            <svg class="control-icon" aria-hidden="true"><use href="#icon-palette" /></svg>
        </button>
        <div class="control-menu" data-menu="theme">
            <button type="button" class="menu-item" data-theme="light">{{ 'controls.theme.light' | t(currentLang) }}</button>
            <button type="button" class="menu-item" data-theme="dark">{{ 'controls.theme.dark' | t(currentLang) }}</button>
            <button type="button" class="menu-item" data-theme="auto">{{ 'controls.theme.auto' | t(currentLang) }}</button>
        </div>
        </div>
        <div class="control-group">
        <button type="button" class="control-btn" data-control="language" aria-label="{{ 'controls.language.switch' | t(currentLang) }}">
            <svg class="control-icon" aria-hidden="true"><use href="#icon-languages" /></svg>
        </button>
        <div class="control-menu" data-menu="language">
            {% for lang in languageList %}
              {% set langData = site.languages[lang] or {} %}
              {% set langUrl = langLinks and langLinks[lang] %}
              <button type="button" class="menu-item{% if lang == currentLang %} is-active{% endif %}" data-lang="{{ lang }}"{% if langUrl %} data-lang-url="{{ langUrl }}"{% endif %}>{{ langData.label or lang | upper }}</button>
            {% endfor %}
        </div>
        </div>
        <div class="control-group">
        <button type="button" class="control-btn" data-control="rss" aria-label="{{ 'controls.feed.switch' | t(currentLang) }}">
            <svg class="control-icon" aria-hidden="true"><use href="#icon-rss" /></svg>
        </button>
        <div class="control-menu" data-menu="rss">
            <a class="menu-item" href="{{ feedPathPrefix }}/feed.xml" target="_blank" rel="noopener noreferrer">{{ 'controls.feed.xml' | t(currentLang) }}</a>
            <a class="menu-item" href="{{ feedPathPrefix }}/feed.json" target="_blank" rel="noopener noreferrer">{{ 'controls.feed.json' | t(currentLang) }}</a>
        </div>
        </div>
        <div class="control-group">
        <a class="control-btn" href="https://github.com/onevcat/ai-ship" target="_blank" rel="noopener noreferrer" aria-label="{{ 'controls.github' | t(currentLang) }}">
            <svg class="control-icon" aria-hidden="true"><use href="#icon-github" /></svg>
        </a>
        </div>
      </div>
    </div>
  <header class="site-header" id="about">
    <div class="container">
      <h1 class="site-title"><span class="site-title__text">{{ siteLangData.title }}</span><span class="site-title__icon" aria-hidden="true"><svg class="icon icon-sailboat" width="96" height="96" fill="none"><use href="#icon-sailboat" /></svg></span></h1>
      <p class="site-description">{{ siteLangData.description }}</p>
      <nav class="site-nav" aria-label="{{ 'nav.main' | t(currentLang) }}">
        <ul>
          {% for item in navigation %}
            <li><a href="{{ item.url }}">{{ item.key | t(currentLang) }}</a></li>
          {% endfor %}
        </ul>
      </nav>
    </div>
  </header>

  <main class="site-main">
    {{ content | safe }}
  </main>

  <footer class="site-footer" id="support">
    <div class="container site-footer__inner">
      <div class="site-footer__left">
        <p>© {{ buildTime | year }} 「{{ siteLangData.title }}」</p>
        <p>{{ 'footer.build' | t(currentLang) }}</p>
      </div>
      <div class="site-footer__right">
        <p>Built by <a href="https://onevcat.com" target="_blank" rel="noopener">@onevcat</a> with ❤️</p>
      </div>
    </div>
  </footer>

  {# -- Article detail overlay -- #}
  <div class="article-overlay" data-article-overlay aria-hidden="true">
    <div class="article-overlay__backdrop" data-article-overlay-dismiss></div>
    <div class="article-overlay__container" role="dialog" aria-modal="true" aria-label="{{ 'article.overlay.dialog' | t(currentLang) }}">
      <div class="article-overlay__body" data-article-overlay-body>
      </div>
    </div>
  </div>

  <div class="image-modal" data-image-modal aria-hidden="true" hidden>
    <div class="image-modal__backdrop" data-image-modal-dismiss></div>
    <div class="image-modal__dialog" role="dialog" aria-modal="true" aria-label="{{ 'image.modal.dialog' | t(currentLang) }}">
      <button type="button" class="image-modal__close" data-image-modal-dismiss>
        <span class="image-modal__close-label visually-hidden">{{ 'image.modal.close' | t(currentLang) }}</span>
        <span aria-hidden="true">&times;</span>
      </button>
      <figure class="image-modal__figure">
        <img data-image-modal-img alt="" />
        <figcaption class="image-modal__caption" data-image-modal-caption hidden></figcaption>
      </figure>
    </div>
  </div>

  <script src="/assets/app.js" type="module" defer></script>
</body>
</html>
